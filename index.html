<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Dopagem Tipo N com Camada de Condução</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a, #1a1a2e);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4fc3f7, #9c27b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #bbdefb;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }

        .simulation-section {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .simulation-section {
                grid-template-columns: 1fr;
            }
        }

        .atoms-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .atoms-title {
            font-size: 1.6rem;
            margin-bottom: 15px;
            color: #4fc3f7;
            text-align: center;
        }

        #atoms-canvas {
            width: 100%;
            height: 600px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .control-group h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 114, 255, 0.3);
            width: 100%;
            margin-bottom: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 114, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3);
        }

        .atom-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .atom-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .atom-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .atom-option.selected {
            background: rgba(79, 195, 247, 0.2);
            border: 2px solid #4fc3f7;
        }

        .atom-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .silicon-preview {
            background: radial-gradient(circle at 30% 30%, #9c27b0, #6a1b9a);
        }

        .phosphorus-preview {
            background: radial-gradient(circle at 30% 30%, #ff9800, #f57c00);
        }

        .slider-control {
            margin: 15px 0;
        }

        .slider-control label {
            display: block;
            margin-bottom: 8px;
            color: #bbdefb;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .selection-info {
            text-align: center;
            color: #4fc3f7;
            font-size: 0.9rem;
            padding: 10px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-panel h2 {
            color: #4fc3f7;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .info-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .info-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-box h3 {
            color: #bbdefb;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
            font-size: 1.2rem;
        }

        .properties {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .property {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .property-name {
            color: #bbdefb;
        }

        .property-value {
            color: #4fc3f7;
            font-weight: 600;
        }

        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .silicon-color {
            background: radial-gradient(circle at 5px 5px, #9c27b0, #6a1b9a);
            box-shadow: 0 0 5px #9c27b0;
        }

        .phosphorus-color {
            background: radial-gradient(circle at 5px 5px, #ff9800, #f57c00);
            box-shadow: 0 0 5px #ff9800;
        }

        .conduction-color {
            background: radial-gradient(circle at 5px 5px, #00e676, #00c853);
            box-shadow: 0 0 5px #00e676;
        }

        .valence-color {
            background: radial-gradient(circle at 5px 5px, #ffeb3b, #fbc02d);
            box-shadow: 0 0 5px #ffeb3b;
        }

        /* Estilos para os elementos da simulação */
        .atom {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .atom:hover {
            transform: scale(1.05);
        }

        .atom.selected {
            border: 3px solid #4fc3f7;
            border-radius: 50%;
            box-shadow: 0 0 30px #4fc3f7;
            z-index: 20;
        }

        .conduction-layer {
            position: absolute;
            border: 2px dashed rgba(0, 230, 118, 0.4);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0, 230, 118, 0.2);
            z-index: 5;
        }

        .conduction-layer.highlighted {
            border: 3px solid #00e676;
            box-shadow: 0 0 30px #00e676;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .electron-shell {
            position: absolute;
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 50%;
        }

        .valence-shell {
            position: absolute;
            border: 2px dashed rgba(255, 235, 59, 0.4);
            border-radius: 50%;
        }

        .valence-shell.highlighted {
            border: 3px solid #ffeb3b;
            box-shadow: 0 0 20px rgba(255, 235, 59, 0.3);
        }

        .nucleus {
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 0 20px;
            z-index: 15;
        }

        .silicon-nucleus {
            background: radial-gradient(circle at 30% 30%, #9c27b0, #6a1b9a);
            box-shadow: 0 0 20px #9c27b0;
        }

        .phosphorus-nucleus {
            background: radial-gradient(circle at 30% 30%, #ff9800, #f57c00);
            box-shadow: 0 0 20px #ff9800;
        }

        .electron {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            z-index: 20;
        }

        .inner-electron {
            background: radial-gradient(circle at 4px 4px, #4fc3f7, #01579b);
            box-shadow: 0 0 8px #4fc3f7;
        }

        .valence-electron {
            background: radial-gradient(circle at 4px 4px, #ffeb3b, #f57f17);
            box-shadow: 0 0 8px #ffeb3b;
        }

        .phosphorus-electron {
            background: radial-gradient(circle at 4px 4px, #ff9800, #f57c00);
            box-shadow: 0 0 8px #ff9800;
        }

        .free-electron {
            background: radial-gradient(circle at 4px 4px, #00e676, #00c853);
            box-shadow: 0 0 12px #00e676;
            animation: electron-glow 2s infinite alternate;
            z-index: 25;
        }

        @keyframes electron-glow {
            from { box-shadow: 0 0 8px #00e676; }
            to { box-shadow: 0 0 20px #00e676; }
        }

        .electron-trail {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #00e676;
            border-radius: 50%;
            opacity: 0.6;
            z-index: 5;
        }

        .info-display {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
            z-index: 30;
        }

        .info-display div {
            font-size: 0.9rem;
            margin: 3px 0;
        }

        .info-label {
            color: #bbdefb;
        }

        .info-value {
            color: #4fc3f7;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulador de Dopagem Tipo N</h1>
            <p class="subtitle">Camada de condução vazia inicialmente - Elétron livre do fósforo se move pela rede</p>
        </header>

        <div class="content">
            <div class="simulation-section">
                <div class="atoms-container">
                    <h2 class="atoms-title">Rede de Átomos com Camada de Condução</h2>
                    <div id="atoms-canvas">
                        <div class="info-display">
                            <div><span class="info-label">Átomos de Fósforo:</span> <span class="info-value" id="phosphorus-count">0</span></div>
                            <div><span class="info-label">Elétrons Livres:</span> <span class="info-value" id="free-electron-count">0</span></div>
                            <div><span class="info-label">Condução:</span> <span class="info-value" id="conduction-status">Inativa</span></div>
                        </div>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color silicon-color"></div>
                            <span>Silício (Si)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color phosphorus-color"></div>
                            <span>Fósforo (P)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color valence-color"></div>
                            <span>Elétron de Valência</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color conduction-color"></div>
                            <span>Elétron Livre (Condução)</span>
                        </div>
                    </div>






<div class="info-panel">
                <h2>Mecanismo de Dopagem Tipo N</h2>
                <div class="info-content">
                    <div class="info-box">
                        <h3>Silício Puro</h3>
                        <div class="properties">
                            <div class="property">
                                <span class="property-name">Elétrons de Valência:</span>
                                <span class="property-value">4</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Camada de Condução:</span>
                                <span class="property-value">Vazia</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Condução:</span>
                                <span class="property-value">Baixa</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Tipo:</span>
                                <span class="property-value">Intrínseco</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <h3>Fósforo (Dopante)</h3>
                        <div class="properties">
                            <div class="property">
                                <span class="property-name">Elétrons de Valência:</span>
                                <span class="property-value">5</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Elétron Extra:</span>
                                <span class="property-value">1 por átomo</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Ocupa:</span>
                                <span class="property-value">Camada de Condução</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Tipo de Dopagem:</span>
                                <span class="property-value">N</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <h3>Comportamento na Rede</h3>
                        <div class="properties">
                            <div class="property">
                                <span class="property-name">Elétron Livre:</span>
                                <span class="property-value">Móvel</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Movimento:</span>
                                <span class="property-value">Entre átomos</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Condução:</span>
                                <span class="property-value">Aumentada</span>
                            </div>
                            <div class="property">
                                <span class="property-name">Aplicação:</span>
                                <span class="property-value">Transistores</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>





                </div>

                <div class="controls-panel">
                    <div class="control-group">
                        <h3>Seleção de Elemento</h3>
                        <div class="atom-selection">
                            <div class="atom-option selected" data-element="Si">
                                <div class="atom-preview silicon-preview">Si</div>
                                <span>Silício</span>
                            </div>
                            <div class="atom-option" data-element="P">
                                <div class="atom-preview phosphorus-preview">P</div>
                                <span>Fósforo</span>
                            </div>
                        </div>
                        <div class="selection-info" id="selection-info">
                            Clique em um átomo para selecionar
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Controles de Visualização</h3>
                        <button id="toggle-conduction" class="active">Destacar Camada de Condução</button>
                        <button id="toggle-valence">Destacar Camada de Valência</button>
                        <button id="toggle-orbitals">Mostrar Orbitais</button>
                        <button id="toggle-nucleus">Mostrar Núcleo</button>
                        <button id="reset-simulation">Resetar Simulação</button>
                    </div>

                    <div class="control-group">
                        <h3>Controles de Animação</h3>
                        <div class="slider-control">
                            <label for="electron-speed">Velocidade dos Elétrons</label>
                            <input type="range" id="electron-speed" min="0" max="100" value="50">
                        </div>
                        <div class="slider-control">
                            <label for="rotation-speed">Velocidade de Rotação</label>
                            <input type="range" id="rotation-speed" min="0" max="100" value="30">
                        </div>
                        <div class="slider-control">
                            <label for="conduction-speed">Velocidade do Elétron Livre</label>
                            <input type="range" id="conduction-speed" min="0" max="100" value="70">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Informações</h3>
                        <div class="info-box" style="padding: 10px; margin: 0;">
                            <p style="font-size: 0.9rem; color: #bbdefb; margin-bottom: 8px;">
                                <strong>Camada de Condução:</strong> Inicialmente vazia, é ocupada pelo elétron extra do fósforo.
                            </p>
                            <p style="font-size: 0.85rem; color: #90a4ae;">
                                O elétron livre pode se mover entre todos os átomos da rede, permitindo condução elétrica.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('atoms-canvas');
            const electronSpeedSlider = document.getElementById('electron-speed');
            const rotationSpeedSlider = document.getElementById('rotation-speed');
            const conductionSpeedSlider = document.getElementById('conduction-speed');
            const selectionInfo = document.getElementById('selection-info');
            const atomOptions = document.querySelectorAll('.atom-option');
            const phosphorusCountElement = document.getElementById('phosphorus-count');
            const freeElectronCountElement = document.getElementById('free-electron-count');
            const conductionStatusElement = document.getElementById('conduction-status');
            
            // Botões de controle
            const toggleConductionBtn = document.getElementById('toggle-conduction');
            const toggleValenceBtn = document.getElementById('toggle-valence');
            const toggleOrbitalsBtn = document.getElementById('toggle-orbitals');
            const toggleNucleusBtn = document.getElementById('toggle-nucleus');
            const resetSimulationBtn = document.getElementById('reset-simulation');
            
            // Variáveis de estado
            let animationId = null;
            let rotationAngle = 0;
            let electronAngle = 0;
            let freeElectronAngle = 0;
            let showOrbitals = true;
            let showNucleusDetail = false;
            let highlightValence = false;
            let highlightConduction = true;
            let selectedAtom = null;
            let selectedElement = 'Si';
            
            // Contadores
            let phosphorusCount = 0;
            let freeElectronCount = 0;
            
            const canvasWidth = canvas.offsetWidth;
            const canvasHeight = canvas.offsetHeight;
            
            // Configuração da grade 3x3
            const gridSize = 3;
            const atomSpacing = 280;
            const startX = (canvasWidth - (gridSize - 1) * atomSpacing) / 2;
            const startY = (canvasHeight - (gridSize - 1) * atomSpacing) / 2;
            
            // Armazenamento de dados
            const atoms = [];
            const allElectronPaths = [];
            const allElectrons = [];
            let freeElectron = null;
            let conductionLayers = [];
            const electronTrails = [];
            
            // Configurações dos elementos
            const elements = {
                'Si': {
                    name: 'Silício',
                    atomicNumber: 14,
                    valenceElectrons: 4,
                    nucleusColor: 'silicon-nucleus',
                    electronConfig: [
                        { radius: 35, electrons: 2, speed: 1.2, type: 'inner' },
                        { radius: 70, electrons: 8, speed: 1.0, type: 'inner' },
                        { radius: 105, electrons: 4, speed: 0.8, type: 'valence' }
                    ]
                },
                'P': {
                    name: 'Fósforo',
                    atomicNumber: 15,
                    valenceElectrons: 5,
                    nucleusColor: 'phosphorus-nucleus',
                    electronConfig: [
                        { radius: 35, electrons: 2, speed: 1.2, type: 'inner' },
                        { radius: 70, electrons: 8, speed: 1.0, type: 'inner' },
                        { radius: 105, electrons: 4, speed: 0.8, type: 'valence' }
                        // O 5º elétron vai para a camada de condução
                    ]
                }
            };
            
            // Criar a rede inicial
            initializeNetwork();
            
            function initializeNetwork() {
                // Limpar canvas
                canvas.innerHTML = '<div class="info-display"><div><span class="info-label">Átomos de Fósforo:</span> <span class="info-value" id="phosphorus-count">0</span></div><div><span class="info-label">Elétrons Livres:</span> <span class="info-value" id="free-electron-count">0</span></div><div><span class="info-label">Condução:</span> <span class="info-value" id="conduction-status">Inativa</span></div></div>';
                
                // Resetar contadores
                phosphorusCount = 0;
                freeElectronCount = 0;
                updateCounters();
                
                // Resetar arrays
                atoms.length = 0;
                allElectronPaths.length = 0;
                allElectrons.length = 0;
                conductionLayers.length = 0;
                
                // Criar 9 átomos em formação 3x3 (inicialmente todos silício)
                for (let row = 0; row < gridSize; row++) {
                    for (let col = 0; col < gridSize; col++) {
                        const centerX = startX + col * atomSpacing;
                        const centerY = startY + row * atomSpacing;
                        const atomId = row * gridSize + col;
                        
                        createAtom(centerX, centerY, atomId, 'Si');
                    }
                }
                
                // Criar camadas de condução para cada átomo
                createConductionLayers();
            }
            
            function createConductionLayers() {
                atoms.forEach(atom => {
                    const conductionLayer = document.createElement('div');
                    conductionLayer.className = 'conduction-layer';
                    if (highlightConduction) {
                        conductionLayer.classList.add('highlighted');
                    }
                    
                    // Camada de condução maior que as outras camadas
                    const conductionRadius = 160;
                    conductionLayer.style.width = `${conductionRadius * 2}px`;
                    conductionLayer.style.height = `${conductionRadius * 2}px`;
                    conductionLayer.style.left = `${atom.centerX - conductionRadius}px`;
                    conductionLayer.style.top = `${atom.centerY - conductionRadius}px`;
                    
                    canvas.appendChild(conductionLayer);
                    conductionLayers.push(conductionLayer);
                });
            }
            
            function createAtom(centerX, centerY, atomId, element) {
                const elementConfig = elements[element];
                const atomData = {
                    id: atomId,
                    centerX: centerX,
                    centerY: centerY,
                    element: element,
                    electronPaths: [],
                    electrons: [],
                    nucleus: null,
                    container: null
                };
                
                atoms[atomId] = atomData;
                
                // Criar container do átomo
                const container = document.createElement('div');
                container.className = 'atom';
                container.style.left = `${centerX - 60}px`;
                container.style.top = `${centerY - 60}px`;
                container.style.width = '120px';
                container.style.height = '120px';
                container.dataset.atomId = atomId;
                
                container.addEventListener('click', function() {
                    selectAtom(atomId);
                });
                
                canvas.appendChild(container);
                atomData.container = container;
                
                // Criar núcleo
                const nucleus = document.createElement('div');
                nucleus.className = `nucleus ${elementConfig.nucleusColor}`;
                nucleus.style.width = '40px';
                nucleus.style.height = '40px';
                nucleus.style.left = '40px';
                nucleus.style.top = '40px';
                nucleus.style.display = showNucleusDetail ? 'block' : 'none';
                container.appendChild(nucleus);
                atomData.nucleus = nucleus;
                
                // Criar camadas eletrônicas
                elementConfig.electronConfig.forEach((shell, shellIndex) => {
                    // Criar orbital
                    const orbital = document.createElement('div');
                    if (shell.type === 'valence') {
                        orbital.className = 'valence-shell';
                        if (highlightValence) {
                            orbital.classList.add('highlighted');
                        }
                    } else {
                        orbital.className = 'electron-shell';
                    }
                    
                    orbital.style.width = `${shell.radius * 2}px`;
                    orbital.style.height = `${shell.radius * 2}px`;
                    orbital.style.left = `${60 - shell.radius}px`;
                    orbital.style.top = `${60 - shell.radius}px`;
                    orbital.style.display = showOrbitals ? 'block' : 'none';
                    
                    container.appendChild(orbital);
                    atomData.electronPaths.push(orbital);
                    allElectronPaths.push(orbital);
                    
                    // Criar elétrons para esta camada
                    const angleStep = (2 * Math.PI) / shell.electrons;
                    
                    for (let i = 0; i < shell.electrons; i++) {
                        const electron = document.createElement('div');
                        if (shell.type === 'valence') {
                            electron.className = 'valence-electron electron';
                        } else {
                            electron.className = 'inner-electron electron';
                        }
                        
                        const angle = i * angleStep;
                        const x = 60 + shell.radius * Math.cos(angle);
                        const y = 60 + shell.radius * Math.sin(angle);
                        
                        electron.style.left = `${x - 7}px`;
                        electron.style.top = `${y - 7}px`;
                        
                        container.appendChild(electron);
                        
                        const electronData = {
                            element: electron,
                            atomId: atomId,
                            shellIndex: shellIndex,
                            angle: angle,
                            radius: shell.radius,
                            speed: shell.speed,
                            type: shell.type
                        };
                        
                        atomData.electrons.push(electronData);
                        allElectrons.push(electronData);
                    }
                });
                
                // Se for fósforo, adicionar elétron especial (que será promovido para condução)
                if (element === 'P') {
                    const extraElectron = document.createElement('div');
                    extraElectron.className = 'phosphorus-electron electron';
                    extraElectron.style.left = '53px';
                    extraElectron.style.top = '53px';
                    container.appendChild(extraElectron);
                    
                    const electronData = {
                        element: extraElectron,
                        atomId: atomId,
                        shellIndex: 2,
                        angle: 0,
                        radius: 105,
                        speed: 0.8,
                        type: 'phosphorus'
                    };
                    
                    atomData.electrons.push(electronData);
                    allElectrons.push(electronData);
                    
                    // Incrementar contador de fósforo
                    phosphorusCount++;
                    
                    // Criar elétron livre na camada de condução
                    createFreeElectron();
                }
            }
            
            function createFreeElectron() {
                // Remover elétron livre anterior (se existir)
                if (freeElectron) {
                    freeElectron.element.remove();
                    freeElectron = null;
                }
                
                // Criar novo elétron livre
                freeElectronCount = phosphorusCount;
                const freeElectronEl = document.createElement('div');
                freeElectronEl.className = 'free-electron electron';
                
                // Posicionar aleatoriamente perto de um átomo de fósforo
                const phosphorusAtoms = atoms.filter(atom => atom.element === 'P');
                if (phosphorusAtoms.length > 0) {
                    const randomPhosphorus = phosphorusAtoms[Math.floor(Math.random() * phosphorusAtoms.length)];
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = 160;
                    const x = randomPhosphorus.centerX + radius * Math.cos(angle);
                    const y = randomPhosphorus.centerY + radius * Math.sin(angle);
                    
                    freeElectronEl.style.left = `${x - 7}px`;
                    freeElectronEl.style.top = `${y - 7}px`;
                } else {
                    // Se não há fósforo, posicionar no centro
                    freeElectronEl.style.left = `${canvasWidth/2 - 7}px`;
                    freeElectronEl.style.top = `${canvasHeight/2 - 7}px`;
                }
                
                canvas.appendChild(freeElectronEl);
                
                freeElectron = {
                    element: freeElectronEl,
                    angle: Math.random() * 2 * Math.PI,
                    speed: 0.02,
                    currentAtomIndex: 0,
                    targetAtomIndex: 0
                };
                
                updateCounters();
                
                // Se há elétron livre, a condução está ativa
                if (freeElectronCount > 0) {
                    conductionStatusElement.textContent = 'Ativa';
                    conductionStatusElement.style.color = '#00e676';
                }
            }
            
            function updateCounters() {
                phosphorusCountElement.textContent = phosphorusCount;
                freeElectronCountElement.textContent = freeElectronCount;
            }
            
            function selectAtom(atomId) {
                // Remover seleção anterior
                if (selectedAtom !== null) {
                    atoms[selectedAtom].container.classList.remove('selected');
                }
                
                // Selecionar novo átomo
                selectedAtom = atomId;
                atoms[atomId].container.classList.add('selected');
                
                const elementName = elements[atoms[atomId].element].name;
                selectionInfo.textContent = `Átomo ${atomId + 1} selecionado (${elementName})`;
            }
            
            function replaceAtom(atomId, newElement) {
                if (atomId === null) return;
                
                const atom = atoms[atomId];
                const oldElement = atom.element;
                
                if (oldElement === newElement) return;
                
                // Atualizar contador de fósforo
                if (oldElement === 'P') phosphorusCount--;
                if (newElement === 'P') phosphorusCount++;
                
                // Remover átomo antigo
                atom.container.remove();
                
                // Criar novo átomo
                createAtom(atom.centerX, atom.centerY, atomId, newElement);
                
                // Se mudou de/para fósforo, atualizar elétron livre
                if (oldElement !== newElement && (oldElement === 'P' || newElement === 'P')) {
                    createFreeElectron();
                }
                
                // Atualizar informação
                const elementName = elements[newElement].name;
                selectionInfo.textContent = `Átomo ${atomId + 1} substituído por ${elementName}`;
                
                // Manter seleção
                selectAtom(atomId);
            }
            
            // Função de animação principal
            function animate() {
                const rotationSpeed = rotationSpeedSlider.value / 100;
                const electronSpeed = electronSpeedSlider.value / 100;
                const conductionSpeed = conductionSpeedSlider.value / 100;
                
                // Rotacionar orbitais
                rotationAngle += 0.001 * rotationSpeed;
                allElectronPaths.forEach(orbital => {
                    orbital.style.transform = `rotate(${rotationAngle}rad)`;
                });
                
                // Mover elétrons orbitais
                electronAngle += 0.005 * electronSpeed;
                allElectrons.forEach(electron => {
                    const newAngle = electron.angle + electronAngle * electron.speed;
                    const x = 60 + electron.radius * Math.cos(newAngle);
                    const y = 60 + electron.radius * Math.sin(newAngle);
                    
                    electron.element.style.left = `${x - 7}px`;
                    electron.element.style.top = `${y - 7}px`;
                });
                
                // Mover elétron livre na camada de condução
                if (freeElectron) {
                    freeElectronAngle += 0.01 * conductionSpeed;
                    
                    // Criar trilha do elétron
                    if (Math.random() > 0.7) {
                        createElectronTrail(freeElectron.element);
                    }
                    
                    // Remover trilhas antigas
                    cleanupElectronTrails();
                    
                    // Movimento complexo do elétron livre - "pula" entre átomos
                    const time = Date.now() / 1000;
                    const baseRadius = 180;
                    const wanderRadius = 50;
                    
                    // Escolher um átomo como referência (muda periodicamente)
                    const atomIndex = Math.floor((time * 0.3) % atoms.length);
                    const currentAtom = atoms[atomIndex];
                    
                    // Posição oscilante ao redor do átomo
                    const angle = freeElectronAngle + atomIndex * 0.5;
                    const radius = baseRadius + Math.sin(time * 2) * wanderRadius;
                    
                    const x = currentAtom.centerX + radius * Math.cos(angle);
                    const y = currentAtom.centerY + radius * Math.sin(angle);
                    
                    freeElectron.element.style.left = `${x - 7}px`;
                    freeElectron.element.style.top = `${y - 7}px`;
                    
                    // Atualizar contador se o elétron estiver perto de um átomo diferente
                    if (freeElectron.currentAtomIndex !== atomIndex) {
                        freeElectron.currentAtomIndex = atomIndex;
                    }
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            function createElectronTrail(electronElement) {
                const trail = document.createElement('div');
                trail.className = 'electron-trail';
                
                const rect = electronElement.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                trail.style.left = `${rect.left - canvasRect.left + 7}px`;
                trail.style.top = `${rect.top - canvasRect.top + 7}px`;
                
                canvas.appendChild(trail);
                electronTrails.push({
                    element: trail,
                    createdAt: Date.now(),
                    lifespan: 1000 // 1 segundo
                });
            }
            
            function cleanupElectronTrails() {
                const now = Date.now();
                for (let i = electronTrails.length - 1; i >= 0; i--) {
                    const trail = electronTrails[i];
                    if (now - trail.createdAt > trail.lifespan) {
                        trail.element.remove();
                        electronTrails.splice(i, 1);
                    } else {
                        // Fade out
                        const age = now - trail.createdAt;
                        const opacity = 0.6 * (1 - age / trail.lifespan);
                        trail.element.style.opacity = opacity;
                    }
                }
            }
            
            // Event listeners para seleção de elemento
            atomOptions.forEach(option => {
                option.addEventListener('click', function() {
                    atomOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedElement = this.dataset.element;
                    
                    if (selectedAtom !== null) {
                        replaceAtom(selectedAtom, selectedElement);
                    } else {
                        selectionInfo.textContent = `Elemento ${elements[selectedElement].name} selecionado. Clique em um átomo para substituir.`;
                    }
                });
            });
            
            // Controles de visualização
            toggleConductionBtn.addEventListener('click', function() {
                highlightConduction = !highlightConduction;
                conductionLayers.forEach(layer => {
                    if (highlightConduction) {
                        layer.classList.add('highlighted');
                        this.classList.add('active');
                    } else {
                        layer.classList.remove('highlighted');
                        this.classList.remove('active');
                    }
                });
                this.textContent = highlightConduction ? 
                    'Ocultar Camada de Condução' : 'Destacar Camada de Condução';
            });
            
            toggleValenceBtn.addEventListener('click', function() {
                highlightValence = !highlightValence;
                allElectronPaths.forEach(orbital => {
                    if (orbital.className.includes('valence-shell')) {
                        if (highlightValence) {
                            orbital.classList.add('highlighted');
                            this.classList.add('active');
                        } else {
                            orbital.classList.remove('highlighted');
                            this.classList.remove('active');
                        }
                    }
                });
                this.textContent = highlightValence ? 
                    'Ocultar Camada de Valência' : 'Destacar Camada de Valência';
            });
            
            toggleOrbitalsBtn.addEventListener('click', function() {
                showOrbitals = !showOrbitals;
                allElectronPaths.forEach(orbital => {
                    orbital.style.display = showOrbitals ? 'block' : 'none';
                });
                this.textContent = showOrbitals ? 
                    'Ocultar Orbitais' : 'Mostrar Orbitais';
            });
            
            toggleNucleusBtn.addEventListener('click', function() {
                showNucleusDetail = !showNucleusDetail;
                atoms.forEach(atom => {
                    atom.nucleus.style.display = showNucleusDetail ? 'block' : 'none';
                });
                this.textContent = showNucleusDetail ? 
                    'Ocultar Núcleo' : 'Mostrar Núcleo';
            });
            
            resetSimulationBtn.addEventListener('click', function() {
                // Resetar simulação
                initializeNetwork();
                
                // Resetar seleção
                if (selectedAtom !== null) {
                    atoms[selectedAtom].container.classList.remove('selected');
                    selectedAtom = null;
                }
                
                // Resetar controles visuais
                showOrbitals = true;
                showNucleusDetail = false;
                highlightValence = false;
                highlightConduction = true;
                
                // Resetar botões
                toggleConductionBtn.classList.add('active');
                toggleValenceBtn.classList.remove('active');
                toggleOrbitalsBtn.textContent = 'Ocultar Orbitais';
                toggleNucleusBtn.textContent = 'Mostrar Núcleo';
                
                // Resetar sliders
                electronSpeedSlider.value = 50;
                rotationSpeedSlider.value = 30;
                conductionSpeedSlider.value = 70;
                
                selectionInfo.textContent = 'Clique em um átomo para selecionar';
                
                // Resetar seleção de elemento
                atomOptions.forEach(opt => opt.classList.remove('selected'));
                document.querySelector('.atom-option[data-element="Si"]').classList.add('selected');
                selectedElement = 'Si';
            });
            
            // Iniciar animação
            animate();
        });
    </script>
</body>
</html>
